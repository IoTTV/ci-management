- project:
    name: iotivity-verify-jobs
    project: 'iotivity'
    jobs:
        - 'iotivity-verify-{component}'
        - 'iotivity-verify-osx'
        - 'iotivity-verify-tizen'
        - 'iotivity-verify-linux_unsecured_with_tcp'
        - 'iotivity-verify-android_{arch}':
            arch:
                - 'armeabi'
                - 'x86':
                    silent: true
        - 'iotivity-verify-windows-{vs-version}':
            vs-version:
                - 'vs2013':
                    silent: false
                    msvc-version: '12.0'
                - 'vs2015':
                    silent: false
                    msvc-version: '14.0'
        - 'iotivity-verify-unit_tests'
    component:
        - 'linux_unsecured'
        - 'linux_unsecured_with_ra':
            silent: true
        - 'linux_unsecured_with_rd':
            silent: true
        - 'linux_secured'
        - 'linux_secured_with_ra':
            silent: true
        - 'linux_secured_with_rd':
            silent: true
        - 'linux_secured_with_java':
            branch: 'generic-java'
            gerrit-branch: 'generic-java'
            refspec: 'refs/heads/generic-java'
        - 'linux_unsecured_with_java':
            branch: 'generic-java'
            gerrit-branch: 'generic-java'
            refspec: 'refs/heads/generic-java'
        - 'arduino'
        - 'simulator'

- job-template:
    name: 'iotivity-verify-linux_unsecured_with_tcp'

    project-type: freestyle
    node: 'ubuntu1204'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - gerrit-branch-scm:
            credentials-id: '{ssh-credentials}'

    triggers:
        - gerrit:
            server-name: 'iotivity'
            trigger-on:
                - patchset-created-event:
                    exclude-drafts: 'false'
                    exclude-trivial-rebase: 'false'
                    exclude-no-code-change: 'true'
                - draft-published-event
                - comment-added-contains-event:
                    comment-contains-value: 'verify all'
                - comment-added-contains-event:
                    comment-contains-value: 'reverify'
            projects:
                - project-compare-type: 'ANT'
                  project-pattern: '{project}'
                  branches:
                    - branch-compare-type: 'REG_EXP'
                      branch-pattern: '^(?!.*1.1-rel).*$'

    wrappers:
        - timestamps

    builders:
        - shell:
            !include-raw-escape: include-raw-iotivity-bootstrap.sh
        - linux-tcp

    publishers:
        - email-notification:
            mailto: 'oicbuild@intel.com'

- job-template:
    name: 'iotivity-verify-{component}'

    project-type: freestyle
    node: 'ubuntu1204'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - gerrit-branch-scm:
            credentials-id: '{ssh-credentials}'

    triggers:
        - gerrit-trigger-patch-submitted:
            silent: '{silent}'
            project: '{project}'
            branch: '{gerrit-branch}'

    wrappers:
        - timestamps

    builders:
        - shell:
            !include-raw-escape: include-raw-iotivity-bootstrap.sh
        - linux:
            component: '{component}'

    publishers:
        - email-notification:
            mailto: 'oicbuild@intel.com'

- job-template:
    name: 'iotivity-verify-tizen'

    project-type: freestyle
    node: 'ubuntu1204'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - gerrit-branch-scm:
            credentials-id: '{ssh-credentials}'

    triggers:
        - gerrit-trigger-patch-submitted:
            silent: '{silent}'
            project: '{project}'
            branch: '{gerrit-branch}'

    wrappers:
        - timestamps

    builders:
        - shell:
            !include-raw-escape: include-raw-iotivity-bootstrap.sh
        - shell:
            !include-raw-escape: include-raw-iotivity-tizen.sh
        - tizen

    publishers:
        - email-notification:
            mailto: 'oicbuild@intel.com'

- job-template:
    name: 'iotivity-verify-unit_tests'

    project-type: freestyle
    node: 'ubuntu1204'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - gerrit-branch-scm:
            credentials-id: '{ssh-credentials}'

    triggers:
        - gerrit-trigger-patch-submitted:
            silent: '{silent}'
            project: '{project}'
            branch: '{gerrit-branch}'

    wrappers:
        - timestamps
        - build-timeout

    builders:
        - shell:
            !include-raw-escape: include-raw-iotivity-bootstrap.sh
        - unit-tests

    publishers:
        - valgrind-report
        - xunit-report
        - archive-artifacts:
            artifacts: '*.memcheck, out/**/test_out/*.xml'
        - email-notification:
            mailto: 'oicbuild@intel.com'

- job-template:
    name: 'iotivity-verify-android_{arch}'

    project-type: freestyle
    node: 'ubuntu1204'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - gerrit-branch-scm:
            credentials-id: '{ssh-credentials}'

    triggers:
        - gerrit-trigger-patch-submitted:
            silent: '{silent}'
            project: '{project}'
            branch: '{gerrit-branch}'

    wrappers:
        - timestamps

    builders:
        - shell:
            !include-raw-escape: include-raw-iotivity-bootstrap.sh
        - android:
            arch: '{arch}'

    publishers:
        - archive-artifacts:
            artifacts: 'android/android_api/base/build/outputs/**/*.xml, android/android_api/base/build/outputs/**/*.html'
        - email-notification:
            mailto: 'oicbuild@intel.com'

- job-template:
    name: 'iotivity-verify-windows-{vs-version}'

    project-type: freestyle
    node: '{vs-version}'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - git:
            credentials-id: '6466b968-939a-4d87-9f7f-0ceb5fca54dc'
            url: 'ssh://jenkins-iotivity@gerrit.iotivity.org:29418/iotivity'
            refspec: '$GERRIT_REFSPEC'
            branches:
                - 'origin/$GERRIT_BRANCH'
            skip-tag: true
            wipe-workspace: true
            choosing-strategy: 'gerrit'

    triggers:
        - gerrit:
            server-name: 'iotivity'
            silent: '{obj:silent}'
            trigger-on:
                - patchset-created-event:
                    exclude-drafts: 'false'
                    exclude-trivial-rebase: 'false'
                    exclude-no-code-change: 'true'
                - draft-published-event
                - comment-added-contains-event:
                    comment-contains-value: 'verify all'
                - comment-added-contains-event:
                    comment-contains-value: 'reverify'
            projects:
                - project-compare-type: 'ANT'
                  project-pattern: '{project}'
                  branches:
                    - branch-compare-type: 'REG_EXP'
                      branch-pattern: '^(?!.*1.1-rel).*$'

    wrappers:
        - timestamps
        - build-timeout-fail

    builders:
        - batch:
            !include-raw-escape: include-raw-iotivity-windows-bootstrap.bat
        - windows:
            msvc-version: '{msvc-version}'

    publishers:
        - postbuildscript:
            script-only-if-succeeded: false
            script-only-if-failed: true
            builders:
                - windows-kill-unit-tests
        - email-notification:
            mailto: 'oicbuild@intel.com'

- job-template:
    name: 'iotivity-verify-osx'

    project-type: freestyle
    node: 'osx1010'
    concurrent: true
    disabled: false

    parameters:
        - gerrit-project:
            project: '{project}'
            branch: '{branch}'
            refspec: '{refspec}'

    scm:
        - gerrit-branch-scm:
            credentials-id: '{ssh-credentials}'

    triggers:
        - gerrit-trigger-patch-submitted:
            silent: '{silent}'
            project: '{project}'
            branch: '{gerrit-branch}'

    wrappers:
        - timestamps
        - build-timeout

    builders:
        - shell:
            !include-raw-escape: include-raw-iotivity-osx-bootstrap.sh
        - osx

    publishers:
        - valgrind-report
        - xunit-report
        - archive-artifacts:
            artifacts: '*.memcheck'
        - email-notification:
            mailto: 'oicbuild@intel.com'
